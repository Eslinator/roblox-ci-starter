name: Probe-Roblox
on: { workflow_dispatch: {} }
permissions: { contents: read }
jobs:
  probe:
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332
      - name: Verify secrets present
        env:
          API:   ${{ secrets.ROBLOX_API_KEY }}
          UNIV:  ${{ secrets.ROBLOX_UNIVERSE_ID }}
          PLACE: ${{ secrets.ROBLOX_PLACE_ID }}
        run: |
          set -euo pipefail
          [ -n "$API" ] && [ -n "$UNIV" ] && [ -n "$PLACE" ] || { echo "Missing secrets"; exit 1; }
          [[ "$UNIV" =~ ^[0-9]+$ ]] && [[ "$PLACE" =~ ^[0-9]+$ ]] || { echo "IDs must be numeric"; exit 1; }
      - name: List places in universe (read-only)
        env:
          API:  ${{ secrets.ROBLOX_API_KEY }}
          UNIV: ${{ secrets.ROBLOX_UNIVERSE_ID }}
        run: |
          set -euo pipefail
          code=$(curl -sS -o resp.json -w "%{http_code}" \
            -H "x-api-key: $API" \
            "https://apis.roblox.com/universes/v1/universes/${UNIV}/places")
          echo "HTTP ${code}"
          cat resp.json || true
          [ "$code" = "200" ]
